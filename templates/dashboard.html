<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartSpend Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body>
  <header class="topbar">
    <h2 class="dashboard-title">SmartSpend Trading-Style Insights</h2>
    <div class="topbar-nav">
      <div class="topbar-primary-actions">
        <a href="/" class="home-btn" id="homeLink"><i class="fa-solid fa-house"></i> Home</a>
        <button type="button" class="home-btn snapshot-btn" id="saveSnapshotBtn" aria-haspopup="dialog" aria-controls="snapshotPermissionModal">
          <i class="fa-solid fa-camera"></i> Save Snapshot
        </button>
      </div>
      <div class="topbar-actions">
        <button class="theme-toggle" data-theme-toggle aria-label="Toggle theme"><i class="fa-solid fa-circle-half-stroke"></i></button>
        <div class="profile-wrapper hidden" id="profileWrapper">
          <button class="profile-btn" id="profileToggle" aria-label="Open profile menu">
            <img id="avatarPreview" src="/static/images/anonymous-avatar.svg" alt="Profile avatar" />
          </button>
          <div class="profile-dropdown hidden" id="profileDropdown">
            <div class="dropdown-header"><strong id="navName">User</strong></div>
            <a href="/profile" id="profileLink">Your Profile</a>
            <a href="#" id="logoutBtn">Sign Out</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <section class="insights-panel reveal-up">
    <h3><i class="fa-solid fa-lightbulb"></i> AI Insights</h3>
    <ul id="insightsList">{% for insight in insights %}<li>{{ insight }}</li>{% endfor %}</ul>
  </section>

  <main class="dashboard">
    <div class="kpi reveal-left"><span>Total Balance</span><strong id="kpiTotal">R {{ total }}</strong></div>
    <div class="kpi reveal-right"><span>Total Profit</span><strong id="kpiAvg">R {{ average }}</strong></div>
    <div class="kpi reveal-left"><span>Pending Orders</span><strong id="kpiPrediction">R {{ prediction }}</strong></div>
    <div class="kpi danger reveal-right"><span>Active Assets</span><strong id="kpiAnomalies">{{ anomalies }}</strong></div>

    <article class="chart reveal-left"><h4>Predictive Spending Trend</h4><p class="chart-note">This line shows if your spending is speeding up or calming down over time. If the line rises fast, spending is growing quickly. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="trendChart"></canvas></article>
    <article class="chart reveal-right"><h4>Category Distribution</h4><p class="chart-note">This donut shows where most of your money goes by category. Bigger slices mean that category takes more of your budget. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="categoryChart"></canvas></article>
    <article class="chart reveal-left"><h4>Monthly Comparison</h4><p class="chart-note">This bar chart compares month-by-month totals so you can spot expensive months and months where spending improved. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="monthlyBarChart"></canvas></article>
    <article class="chart reveal-right"><h4>Transaction Scatter</h4><p class="chart-note">Each dot is one transaction. Dots far away from the cluster are unusual spends that may need a quick check. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="scatterChart"></canvas></article>
    <article class="chart reveal-left"><h4>Cumulative Spend Curve</h4><p class="chart-note">This chart adds spending over time so you can see how fast your total costs are building up. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="cumulativeChart"></canvas></article>
    <article class="chart reveal-right"><h4>Rolling Average Signal</h4><p class="chart-note">This smooth line removes short-term noise so you can see the real spending direction more clearly. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="rollingChart"></canvas></article>
    <article class="chart reveal-left"><h4>Spending Velocity</h4><p class="chart-note">This shows how much spending changed from one point to the next, making sudden jumps easy to notice. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="velocityChart"></canvas></article>
    <article class="chart reveal-right"><h4>Volatility Radar</h4><p class="chart-note">This radar highlights categories with unstable spending. Bigger spikes mean that category changes a lot and is less predictable. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="volatilityChart"></canvas></article>
    <article class="chart reveal-up"><h4>Fixed vs Variable Split</h4><p class="chart-note">This split compares fixed costs (like bills) vs flexible costs (like optional spending) so you can see how much is controllable. <span class="focus-hint">Double-tap or double-click to focus this chart.</span></p><canvas id="expenseTypeChart"></canvas></article>
  </main>

  <div class="snapshot-permission-modal hidden" id="snapshotPermissionModal" role="dialog" aria-modal="true" aria-labelledby="snapshotPermissionTitle">
    <div class="snapshot-permission-card">
      <h3 id="snapshotPermissionTitle"><i class="fa-solid fa-shield"></i> Snapshot Permissions</h3>
      <p>
        SmartSpend will ask your browser for a one-time capture permission. After you choose your current tab/screen,
        your snapshot downloads immediately and capture stops.
      </p>
      <ul>
        <li>No audio is captured.</li>
        <li>Only this snapshot action runs, and then permission is released.</li>
      </ul>
      <div class="snapshot-permission-actions">
        <button type="button" class="btn btn-secondary" id="snapshotCancelBtn">Cancel</button>
        <button type="button" class="btn" id="snapshotContinueBtn">Continue</button>
      </div>
    </div>
  </div>


  <footer class="app-footer reveal">
    <div class="footer-row">
      <span>SmartSpend AI Â© 2026</span>
      <span class="footer-icons">
        <a href="https://github.com/skumalo0115-commits" target="_blank" rel="noopener"><i class="fa-brands fa-github"></i></a>
        <a href="https://www.linkedin.com/in/sbahle-kumalo-b4b498267" target="_blank" rel="noopener"><i class="fa-brands fa-linkedin"></i></a>
        <a href="https://www.facebook.com/share/1DL66XnWr5/?mibextid=wwXIfr" target="_blank" rel="noopener"><i class="fa-brands fa-facebook"></i></a>
        <a href="https://wa.me/27827744933" target="_blank" rel="noopener" aria-label="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
        <a href="tel:0827744933" aria-label="Call"><i class="fa-solid fa-phone"></i></a>
      </span>
    </div>
  </footer>

  <script>
    window.__JINJA_MONTHS__ = '{{ months | tojson }}';
    window.__JINJA_MONTHLY__ = '{{ monthly | tojson }}';
    window.__JINJA_CATEGORIES__ = '{{ categories | tojson }}';
    window.__JINJA_CATEGORY_TOTALS__ = '{{ category_totals | tojson }}';
    window.__JINJA_AMOUNTS__ = '{{ amounts | tojson }}';
    window.__JINJA_DATES__ = '{{ dates | tojson }}';
    window.__JINJA_CUMULATIVE__ = '{{ cumulative | tojson }}';
    window.__JINJA_ROLLING__ = '{{ rolling | tojson }}';
    window.__JINJA_VELOCITY__ = '{{ velocity | tojson }}';
    window.__JINJA_VOL_LABELS__ = '{{ volatility_labels | tojson }}';
    window.__JINJA_VOL_VALUES__ = '{{ volatility_values | tojson }}';
    window.__JINJA_EXPENSE_LABELS__ = '{{ expense_labels | tojson }}';
    window.__JINJA_EXPENSE_VALUES__ = '{{ expense_values | tojson }}';
    window.__JINJA_INSIGHTS__ = '{{ insights | tojson }}';
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="/static/js/app.js"></script>
  <script defer src="/static/js/dashboard-page.js"></script>
</body>
</html>